   
<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Madison Landlord Map</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    .quakeInfo {
      position: absolute;
      font-family: sans-serif;
      margin-top: 5px;
      margin-left: 5px;
      padding: 5px;
      width: 30%;
      border: 2px solid black;
      font-size: 14px;
      color: #222;
      background-color: #fff;
      border-radius: 3px;
    }
  </style>
</head>

<body>

  <div id='map'></div>
  <div id="map-overlay" class="map-overlay"></div>
  <div class='quakeInfo'>
    <div><strong>Landlord:</strong> <span id='name'></span></div>
    <div><strong>Address:</strong> <span id='address'></span></div>
    <div><strong>Property Value:</strong> <span id='value'></span></div>
    <div><strong>Property Type:</strong> <span id='type'></span></div>
    <div><strong>Total Number of Properties:</strong> <span id='total_num'></span></div>
    <div><strong>Total Value of Properties:</strong> <span id='total_value'></span></div>
  </div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoidGVkY2ExMjMiLCJhIjoiY2s5Z2VzZHRrMG4waTNrbndrNzdlbTdhMSJ9.20o57usCauX4WzpxsZxXMg';
    var map = new mapboxgl.Map({
      container: 'map', // Specify the container ID
      style: 'mapbox://styles/mapbox/light-v10', // Specify which map style to use
      center: [-89.4012, 43.0731], // Specify the starting position [lng, lat]
      zoom: 11 // Specify the starting zoom
    });

    // Target the relevant span tags in the quakeInfo div
    var nameDisplay = document.getElementById('name');
    var addressDisplay = document.getElementById('address');
    var valueDisplay = document.getElementById('value');
    var typeDisplay = document.getElementById('type');
    var totvalueDisplay = document.getElementById('total_value');
    var totnumDisplay = document.getElementById('total_num');

    // // Create a popup, but don't add it to the map yet.
    // var popup = new mapboxgl.Popup({
    // closeButton: false
    // });


    map.on('load', function() {

      map.addSource('landlords', {
        'type': 'geojson',
        'data': 'landlords.geojson',
        'generateId': true // This ensures that all features have unique IDs
        
      });

      map.addLayer({
        'id': 'landlords-viz',
        'type': 'circle',
        'source': 'landlords',
        
        'paint': {
          'circle-radius': 3,
          'circle-color': '#000',
          'circle-opacity': .5,

          
          }
        
      }
      
      ,
      'settlement-label');


    map.addLayer(
      {
      'id': 'counties-highlighted',
      'type': 'circle',
      'source': 'landlords',
      'paint': {
      'circle-radius': 4.5,
      'circle-color': '#C959CE',
      "circle-stroke-width": .5,
      "circle-stroke-color": '#000'
      },
      'filter': ['in', 'owner', '']
      },
      'settlement-label'
      ); // Place polygon under these labels.

      // map.addLayer(
      // {
      // 'id': 'counties-unhighlighted',
      // 'type': 'circle',
      // 'source': 'landlords',
      // 'paint': {
      // 'circle-color': '#fff',
      // "circle-opacity": .01
      // },
      // 'filter': ['!in', 'owner', '']
      // },
      // 'settlement-label'
      // ); 
      

      map.on('click', 'landlords-viz', (e) => {

});

    });


    var addressID = null;

    map.on('mousemove', 'landlords-viz', (e) => {

      // Single out the first found feature.
      var feature = e.features[0];
      console.log(feature.properties)

      // Query the counties layer visible in the map. Use the filter
      // param to only collect results that share the same county name.
      var unrelatedFeatures = map.querySourceFeatures('landlords', {
      filter: ['!in', 'owner', feature.properties.owner]
      });

      console.log(unrelatedFeatures)

        
      // Add features that share the same county name to the highlighted layer.
      map.setFilter('counties-highlighted', [
      'in',
      'owner',
      feature.properties.owner
      ]);

      

      map.getCanvas().style.cursor = 'pointer';
      // Set variables equal to the current feature's magnitude, location, and time
      var landlordName = e.features[0].properties.owner;
      var propAddress = e.features[0].properties.address;
      var propValue = e.features[0].properties.value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      var propType = e.features[0].properties.property_type;
      var totValue = e.features[0].properties.total_value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      var totNum = e.features[0].properties.Num_Properties.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

      // Check whether features exist
      if (e.features.length > 0) {
        // Display the magnitude, location, and time in the sidebar
        nameDisplay.textContent = landlordName;
        addressDisplay.textContent = propAddress;
        valueDisplay.textContent = propValue;
        typeDisplay.textContent = propType;
        totvalueDisplay.textContent = totValue;
        totnumDisplay.textContent = totNum;

        // If addressID for the hovered feature is not null,
        // use removeFeatureState to reset to the default behavior
        if (addressID) {
          map.removeFeatureState({
            source: "landlords",
            id: addressID
          });
        }

        addressID = e.features[0].id;

        // When the mouse moves over the landlords-viz layer, set the
        // feature state for the feature under the mouse
        map.setFeatureState({
          source: 'landlords',
          id: addressID,
        }, {
          hover: true
        });

      }
        
    });

    

    map.on("mouseleave", "landlords-viz", function() {

      // popup.remove();

      map.getCanvas().style.cursor = 'pointer';

      if (addressID) {
        map.setFeatureState({
          source: 'landlords',
          id: addressID
        }, {
          hover: false
        });
      }
      // Reset the cursor style
      map.getCanvas().style.cursor = '';
    });
  </script>

</body>

</html>
